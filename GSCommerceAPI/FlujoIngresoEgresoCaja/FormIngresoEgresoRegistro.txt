using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using BusinessLayer;
using DataAccess;

namespace WinFrontEnd
{
    public partial class FormIngresoEgresoRegistro : Form
    {
        IngresosEgresosCabecera Cabecera = new IngresosEgresosCabecera();
        List<IngresosEgresosCabecera> ListaCabecera = new List<IngresosEgresosCabecera>();
        ClassValidaFormulario cvf = new ClassValidaFormulario();
        BindingList<IngresosEgresosDetalle> DetalleIngresoEgreso = new BindingList<IngresosEgresosDetalle>();
        ProveedorClass Proveedor = new ProveedorClass();
        List<Proveedor> Provee = new List<Proveedor>();
        AperturaCierreCajaClass AperturaCaja = new AperturaCierreCajaClass();
        AuxiliarVariosClass AuxiliarVarios = new AuxiliarVariosClass();
        IngresosEgresosClass IngresoEgreso = new IngresosEgresosClass();
        AlmacenCuentaClass ALCU = new AlmacenCuentaClass();
        AlmacenClass AlmacenClase = new AlmacenClass();

        string Naturaleza;

        int CantidadCajerosCajaAbierta;
        decimal MontoTotal;
        int LineaNueva;
        string Foco;
        int IdProv;
        string BancoProveedor;
        string CuentaProveedor;
        Image Foto;
        DateTime Fecha;

        Boolean Nuevo;
        int IdIngresoEgreso;
        
        public FormIngresoEgresoRegistro(string _naturaleza, DateTime _fecha, Boolean _nuevo, int _idingresoegreso)
        {
            InitializeComponent();

            Naturaleza = _naturaleza;
            Fecha = _fecha;

            Nuevo = _nuevo;
            IdIngresoEgreso = _idingresoegreso;

            FechaLabel.Text = _fecha.ToString("dd/MM/yyyy");

            if (Naturaleza == "Ingreso")
            {

                TipoIngresoComboBox.Visible = true;
                TipoEgresoComboBox.Visible = false;
                AlmacenGastoCheckBox.Visible = false;
                AlmacenGastoComboBox.Visible = false;
                this.Text = "Registro de Ingreso";

            }
            else
            {

                TipoEgresoComboBox.Visible = true;
                TipoEgresoComboBox.Location = new Point(TipoIngresoComboBox.Location.X, TipoIngresoComboBox.Location.Y);
                TipoIngresoComboBox.Visible = false;
                AlmacenGastoComboBox.Enabled = false;
                this.Text = "Registro de Egreso";

            }

            this.KeyPreview = true;
            this.KeyPress += new KeyPressEventHandler(FormIngresoEgresoRegistro_KeyPress);

            if (!Nuevo)
            {
                if (Naturaleza == "Ingreso")
                    TipoIngresoComboBox.Enabled = false;
                else
                    TipoEgresoComboBox.Enabled = false;
            }

        }

        private void FormIngresoEgresoRegistro_KeyPress(object sender, KeyPressEventArgs e)
        {

            if (this.ActiveControl.Tag != null)
                cvf.ValidaTeclas(this.ActiveControl.Tag.ToString(), e);

        }

        private void FormIngresoEgresoRegistro_Load(object sender, EventArgs e)
        {
            CargaCombos();
            Inicializa();
        }

        private void Inicializa()
        {
            FormaComboBox.SelectedIndex = 0;

            if (Nuevo)
            { 
                if (Naturaleza == "Ingreso")
                {
                    TipoIngresoComboBox.SelectedIndex = 0;
                }
                else
                {
                    TipoEgresoComboBox.SelectedIndex = 0;
                }
            }
            else
            {
                Cabecera = IngresoEgreso.CabeceraModificar(IdIngresoEgreso);
                //DetalleIngresoEgreso = IngresoEgreso.DetalleModificar(IdIngresoEgreso);

                GlosaTextBox.Text = Cabecera.Glosa;
                MontoTotalLabel.Text = Cabecera.Monto.ToString("N2");
                MontoTotal = Cabecera.Monto;

                if (Naturaleza == "Ingreso")
                {
                    TipoIngresoComboBox.Text = Cabecera.Tipo;
                }
                else
                {
                    TipoEgresoComboBox.Text = Cabecera.Tipo;

                    switch (TipoEgresoComboBox.Text)
                    {
                        case "GASTOS DIVERSOS":

                            GlosaTextBox.Height = CabeceraSplitContainer.Bottom - GlosaTextBox.Top;
                            CabeceraSplitContainer.Visible = false;
                            break;

                        //case "TRANSFERENCIA":

                        //    GlosaTextBox.Height = 38;
                        //    CabeceraSplitContainer.Visible = true;
                        //    CabeceraSplitContainer.Panel1Collapsed = true;
                        //    RUCProveedorTextBox.Enabled = false;
                        //    BuscarProveedorButton.Enabled = false;
                        //    AlmacenComboBox.Enabled = true;
                        //    CajeroComboBox.Enabled = true;

                        //    AlmacenComboBox.DataSource = null;

                        //    AlmacenComboBox.DisplayMember = "Almacen";
                        //    AlmacenComboBox.ValueMember = "IdAlmacen";
                        //    AlmacenComboBox.DataSource = AperturaCaja.AlmacenesAperturaFechaNoCerrada(Fecha, VariablesPublicas._IdAlmacen, VariablesPublicas._IdUsuario);
                        //    break;

                        case "PAGO PROVEEDORES":

                            GlosaTextBox.Height = CabeceraSplitContainer.Top - GlosaTextBox.Top; 
                            CabeceraSplitContainer.Visible = true;
                            CabeceraSplitContainer.Panel2Collapsed = true;
                            RUCProveedorTextBox.Enabled = true;
                            BuscarProveedorButton.Enabled = true;
                            AlmacenComboBox.Enabled = false;
                            CajeroComboBox.Enabled = false;
                            IdProv = Cabecera.IdProveedor.Value;

                            Provee = Proveedor.ObtenerProveedorXId(IdProv);

                            RUCProveedorTextBox.Text = Provee[0].RUC;
                            NombreProveedorLabel.Text = Provee[0].Nombre;
                            BancoProveedor = Provee[0].Banco;
                            CuentaProveedor = Provee[0].Cuenta;

                            break;
                        default:

                            GlosaTextBox.Height = CabeceraSplitContainer.Bottom - GlosaTextBox.Top;
                            CabeceraSplitContainer.Visible = false;
                            break;
                    }
                }

                DetalleIngresoEgreso = IngresoEgreso.DetalleModificar(IdIngresoEgreso);
            }
            
            DetalleBindingSource.DataSource = DetalleIngresoEgreso;

            if (DetalleIngresoEgreso.Count > 0)
            {
                for (int i = 0; i < DetalleIngresoEgreso.Count; i++ )
                {
                    if (DetalleIngresoEgreso[i].Imagen != null)
                    {
                        GrillaDataGridView[9, i].Value = Properties.Resources.lupa16;
                    }
                    else
                    {
                        GrillaDataGridView[9, i].Value = Properties.Resources.null16;
                    }
                }
            }

        }

        private void CargaCombos()
        {
            BancoComboBox.DataSource = null;

            BancoComboBox.ValueMember = "Descripcion";
            BancoComboBox.DisplayMember = "Descripcion";
            BancoComboBox.DataSource = AuxiliarVarios.ObtenerLista("BANCO");

            if (Naturaleza == "Egreso")
            {
                AlmacenGastoComboBox.ValueMember = "IdAlmacen";
                AlmacenGastoComboBox.DisplayMember = "Nombre";
                AlmacenGastoComboBox.DataSource = AlmacenClase.ObtenerLista();

                AlmacenGastoComboBox.SelectedValue = VariablesPublicas._IdAlmacen;
            }

            if (VariablesPublicas._Cargo != "ADMINISTRADOR") return;

            TipoEgresoComboBox.Items.Add("AFP-REPORTE");
            TipoEgresoComboBox.Items.Add("SUNAT-REPORTE");
            TipoEgresoComboBox.Items.Add("ALQUILER-REPORTE");
        }

        private void TipoIngresoComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            DetalleIngresoEgreso.Clear();

            switch (TipoIngresoComboBox.Text)
            {
                case "SOBRANTE DE CAJA":

                    GlosaTextBox.Height = CabeceraSplitContainer.Bottom - GlosaTextBox.Top;
                    CabeceraSplitContainer.Visible = false;
                    FormaComboBox.SelectedIndex = 0;
                    FormaComboBox.Enabled = false;

                    break;

            }

            GlosaTextBox.Focus();
            GlosaTextBox.SelectAll();

        }

        private void TipoEgresoComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            DetalleIngresoEgreso.Clear();

            AlmacenGastoCheckBox.Visible = true;
            AlmacenGastoComboBox.Visible = true;
            AlmacenGastoCheckBox.Checked = false;

            switch (TipoEgresoComboBox.Text)
            {
                case "GASTOS DIVERSOS":

                    GlosaTextBox.Height = CabeceraSplitContainer.Bottom - GlosaTextBox.Top;
                    CabeceraSplitContainer.Visible = false;

                    //CargaCombos();

                    break;

                case "TRANSFERENCIA":

                    GlosaTextBox.Height = CabeceraSplitContainer.Top - GlosaTextBox.Top; 
                    CabeceraSplitContainer.Visible = true;
                    CabeceraSplitContainer.Panel1Collapsed = true;
                    RUCProveedorTextBox.Enabled = false;

                    BuscarProveedorButton.Enabled = false;
                    AlmacenComboBox.Enabled = true;
                    CajeroComboBox.Enabled = true;

                    AlmacenComboBox.DataSource = null;

                    AlmacenComboBox.DisplayMember = "Almacen";
                    AlmacenComboBox.ValueMember = "IdAlmacen";
                    AlmacenComboBox.DataSource = AperturaCaja.AlmacenesAperturaFechaNoCerrada(Fecha, VariablesPublicas._IdAlmacen, VariablesPublicas._IdUsuario);

                    //AlmacenComboBox.SelectedIndex = 0;

                    //CargaCombos();

                    //BancoComboBox.DataSource = null;

                    //BancoComboBox.ValueMember = "Cuenta";
                    //BancoComboBox.DisplayMember = "Banco";
                    //BancoComboBox.DataSource = ALCU.ObtenerLista(int.Parse(AlmacenComboBox.SelectedValue.ToString()));

                    AlmacenGastoCheckBox.Visible = false;
                    AlmacenGastoComboBox.Visible = false;

                    break;

                case "PAGO PROVEEDORES":

                    GlosaTextBox.Height = CabeceraSplitContainer.Top - GlosaTextBox.Top; 
                    CabeceraSplitContainer.Visible = true;
                    CabeceraSplitContainer.Panel2Collapsed = true;
                    RUCProveedorTextBox.Enabled = true;
                    BuscarProveedorButton.Enabled = true;
                    AlmacenComboBox.Enabled = false;
                    CajeroComboBox.Enabled = false;
                    IdProv = 0;

                    //CargaCombos();

                    break;
                default:

                    GlosaTextBox.Height = CabeceraSplitContainer.Bottom - GlosaTextBox.Top;
                    CabeceraSplitContainer.Visible = false;

                    //CargaCombos();

                    break;

            }

            //CargaCombos();

            GlosaTextBox.Focus();
            GlosaTextBox.SelectAll();

        }

        private void FormaComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {

            switch (FormaComboBox.Text)
            {
                case "EFECTIVO":

                    BancoLabel.Visible = false;
                    BancoComboBox.Visible = false;
                    CuentaLabel.Visible = false;
                    CuentaTextBox.Visible = false;
                    DetalleTextBox.Width = 497;

                    break;

                case "DEPOSITO":

                    BancoLabel.Visible = true;
                    BancoComboBox.Visible = true;
                    BancoComboBox.Enabled = true;
                    CuentaLabel.Visible = true;
                    CuentaTextBox.Visible = true;
                    CuentaTextBox.Enabled = true;
                    DetalleTextBox.Width = 315;

                    //if (Naturaleza == "Egreso")
                    //{

                    //    switch (TipoEgresoComboBox.Text)
                    //    {

                    //        case "PAGO PROVEEDORES":

                    //            BancoComboBox.Text = BancoProveedor;
                    //            BancoComboBox.Enabled = false;
                    //            CuentaTextBox.Text = CuentaProveedor;
                    //            CuentaTextBox.Enabled = false;

                    //            break;
                    //        case "TRANSFERENCIA":

                    //            CuentaTextBox.Enabled = false;

                    //            break;

                    //    }

                    //}

                    break;

            }

        }

        private void AgregaButton_Click(object sender, EventArgs e)
        {

            if (cvf.VerificaInformacionCompleta(DetalleGroupBox, this))
            {

                IngresosEgresosDetalle NuevoDetalle = new IngresosEgresosDetalle();
                LineaNueva = GrillaDataGridView.Rows.Count + 1;

                if (!Nuevo)
                    NuevoDetalle.IdIngresoEgreso = IdIngresoEgreso;

                NuevoDetalle.Forma = FormaComboBox.Text.Trim();
                NuevoDetalle.Detalle = DetalleTextBox.Text.Trim();
                NuevoDetalle.Monto = decimal.Parse(MontoTextBox.Text);

                if (FormaComboBox.Text == "DEPOSITO")
                {

                    NuevoDetalle.Banco = BancoComboBox.Text.Trim();
                    NuevoDetalle.Cuenta = CuentaTextBox.Text.Trim();

                }

                if (Foto != null)
                {
                    NuevoDetalle.Imagen = IngresoEgreso.ImageToByte(Foto);
                    DetalleIngresoEgreso.Add(NuevoDetalle);
                    GrillaDataGridView[9, LineaNueva - 1].Value = Properties.Resources.lupa16;

                }
                else
                {
                    NuevoDetalle.Imagen = null;
                    DetalleIngresoEgreso.Add(NuevoDetalle);
                    GrillaDataGridView[9, LineaNueva - 1].Value = Properties.Resources.null16;
                }           

                DetalleTextBox.Text = "";
                MontoTextBox.Text = "";

                if (FormaComboBox.Text == "DEPOSITO")
                {

                    CuentaTextBox.Text = "";

                }

                CalculaTotales();

                FormaComboBox.SelectedIndex = 0;
                DetalleTextBox.Focus();
                Foto = null;

            }

        }

        private void QuitaButton_Click(object sender, EventArgs e)
        {
            if (GrillaDataGridView.Rows.Count >= 1)
            {
                DetalleIngresoEgreso.RemoveAt(GrillaDataGridView.CurrentRow.Index);
                CalculaTotales();
            }
        }

        private void CalculaTotales()
        {

            MontoTotal = 0;

            foreach (IngresosEgresosDetalle LineaDetalle in DetalleIngresoEgreso)
            {

                MontoTotal = MontoTotal + LineaDetalle.Monto;
                
            }

            MontoTotalLabel.Text = MontoTotal.ToString("N2");

        }

        private void GrabarModificarButton_Click(object sender, EventArgs e)
        {
            Boolean Grabar = true;

            if (Naturaleza == "Ingreso")
            {

                switch (TipoIngresoComboBox.Text)
                {
                    case "SOBRANTE DE CAJA":

                        if (GlosaTextBox.Text.Trim(' ') == "")
                        { 
                            Grabar = false;
                            MessageBox.Show("¡Ingrese glosa!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            GlosaTextBox.Focus();
                        }

                        break;

                }

            }
            else
            {
 
                switch (TipoEgresoComboBox.Text)
                {
                    case "GASTOS DIVERSOS":

                        if (GlosaTextBox.Text.Trim(' ') == "")
                        {
                            Grabar = false;
                            MessageBox.Show("¡Ingrese glosa!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            GlosaTextBox.Focus();
                        }

                        break;

                    case "TRANSFERENCIA":

                        if (GlosaTextBox.Text.Trim(' ') == "")
                        {
                            Grabar = false;
                            MessageBox.Show("¡Ingrese glosa!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            GlosaTextBox.Focus();
                        }
                        else if(AlmacenComboBox.Items.Count == 0 || CajeroComboBox.Items.Count == 0)
                        {
                            Grabar = false;
                            MessageBox.Show("¡No hay Almacen o Cajero con caja aperturada en esta fecha: " + FechaLabel.Text + "!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            AlmacenComboBox.Focus();
                        }

                        break;

                    case "PAGO PROVEEDORES":

                        if (GlosaTextBox.Text.Trim(' ') == "")
                        {
                            Grabar = false;
                            MessageBox.Show("¡Ingrese glosa!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            GlosaTextBox.Focus();
                        }
                        else if (IdProv == 0)
                        {
                            Grabar = false;
                            MessageBox.Show("¡Seleccione Proveedor!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            RUCProveedorTextBox.Focus();
                        }
                        //else if (RUCProveedorTextBox.Text == "" || NombreProveedorLabel.Text == "")
                        //{
                        //    Grabar = false;
                        //    MessageBox.Show("¡Ingrese información del Proveedor!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                        //    RUCProveedorTextBox.Focus();
                        //}

                        break;

                    default:

                        if (GlosaTextBox.Text.Trim(' ') == "")
                        {
                            Grabar = false;
                            MessageBox.Show("¡Ingrese glosa!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                            GlosaTextBox.Focus();
                        }

                        break;

                }

            }

            if (GrillaDataGridView.RowCount == 0)
            {

                Grabar = false;
                MessageBox.Show("¡Ingrese Detalles del " + Naturaleza +"!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

            }
            
            if (Grabar)
            {

                DialogResult result;

                result = MessageBox.Show("¿Desea grabar el " + Naturaleza, "S.G.V.", MessageBoxButtons.YesNo, MessageBoxIcon.Question);

                if (result == System.Windows.Forms.DialogResult.Yes)
                {
                    if (Nuevo)
                    {
                        Cabecera.IdIngresoEgreso = 0;
                        Cabecera.IdUsuario = VariablesPublicas._IdUsuario;
                        Cabecera.IdAlmacen = VariablesPublicas._IdAlmacen;
                        Cabecera.Naturaleza = Naturaleza.Substring(0, 1);

                        if (Naturaleza == "Ingreso")
                        {
                            Cabecera.Tipo = TipoIngresoComboBox.Text;
                            Cabecera.Glosa = GlosaTextBox.Text.Trim();
                        }
                        else
                        {
                            Cabecera.Tipo = TipoEgresoComboBox.Text;
                            if (VariablesPublicas._IdAlmacen == int.Parse(AlmacenGastoComboBox.SelectedValue.ToString()))
                                Cabecera.Glosa = GlosaTextBox.Text.Trim();
                            else
                                Cabecera.Glosa = GlosaTextBox.Text.Trim() + " (" + AlmacenGastoComboBox.Text + ")";
                        }

                        Cabecera.Fecha = Fecha;

                        Cabecera.Monto = MontoTotal;

                        if (Naturaleza == "Egreso")
                        {
                            switch (TipoEgresoComboBox.Text)
                            {

                                case "TRANSFERENCIA":

                                    Cabecera.IdAlmacenDestino = int.Parse(AlmacenComboBox.SelectedValue.ToString());
                                    Cabecera.IdCajeroDestino = int.Parse(CajeroComboBox.SelectedValue.ToString());

                                    Cabecera.IdAlmacenGasto = VariablesPublicas._IdAlmacen;

                                    break;

                                case "PAGO PROVEEDORES":

                                    Cabecera.IdProveedor = IdProv;

                                    Cabecera.IdAlmacenGasto = int.Parse(AlmacenGastoComboBox.SelectedValue.ToString());

                                    break;

                                default:

                                    Cabecera.IdAlmacenGasto = int.Parse(AlmacenGastoComboBox.SelectedValue.ToString());

                                    break;
                            }
                        }

                        Cabecera.Estado = "E";

                    }
                    else
                    {
                        Cabecera.Glosa = GlosaTextBox.Text.Trim();
                        Cabecera.Monto = MontoTotal;

                        if (Naturaleza == "Egreso")
                        {
                            switch (TipoEgresoComboBox.Text)
                            {

                                //case "TRANSFERENCIA":

                                //    Cabecera.IdAlmacenDestino = int.Parse(AlmacenComboBox.SelectedValue.ToString());
                                //    Cabecera.IdCajeroDestino = int.Parse(CajeroComboBox.SelectedValue.ToString());

                                //    break;

                                case "PAGO PROVEEDORES":

                                    Cabecera.IdProveedor = IdProv;

                                    break;
                            }

                        }
                    }
                    
                    ListaCabecera.Add(Cabecera);

                    if (IngresoEgreso.InsertaIngresoEgreso(ListaCabecera, DetalleIngresoEgreso))
                    {
                        MessageBox.Show("¡Datos registrados con éxito!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Information);

                        this.Close();
                    }

                    ListaCabecera.Clear();
                    
                }
            }

        }

        private void SalirButton_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void TipoDeCambio()
        {

            //TCDia = TipodeCambio.ObtenerListaxDia(FechaOCDateTimePicker.Value);

            //if (TCDia.Count() == 1)
            //    TCLabel.Text = "TC: " + TCDia[0].Compra.ToString("N2");
            //else
            //    TCLabel.Text = "TC: NO REGISTRADO";

        }

        private void RUCProveedorTextBox_Enter(object sender, EventArgs e)
        {
            Foco = "P";
        }

        private void RUCProveedorTextBox_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (Foco == "P")
            {
                if (e.KeyChar == (char)(Keys.Enter))
                {

                    e.Handled = true;

                    BuscaProveedor();

                }
            }
        }

        private void RUCProveedorTextBox_Leave(object sender, EventArgs e)
        {

            //if (Foco == "P")
            //{

            //    BuscaProveedor();

            //}

            Foco = "";

        }

        private void BuscaProveedor()
        {

            Provee = Proveedor.ObtenerProveedorXRUC(RUCProveedorTextBox.Text);

            if (Provee.Count == 1)
            {
                IdProv = Provee[0].IdProveedor;
                NombreProveedorLabel.Text = Provee[0].Nombre;
                BancoProveedor = Provee[0].Banco;
                CuentaProveedor = Provee[0].Cuenta;

                DetalleTextBox.Focus();
                Foco = "";

            }
            else
            {

                MessageBox.Show("¡Proveedor no registrado!", "S.G.V.", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                RUCProveedorTextBox.Focus();
                RUCProveedorTextBox.SelectAll();

            }

        }

        private void BuscaProveedorButton_Click(object sender, EventArgs e)
        {

            FormBuscarProveedor fbprov = new FormBuscarProveedor();

            fbprov.ShowDialog();

            if (fbprov.Prov != null)
            {
                IdProv = fbprov.Prov.IdProveedor;
                RUCProveedorTextBox.Text = fbprov.Prov.RUC;
                NombreProveedorLabel.Text = fbprov.Prov.Nombre;
                BancoProveedor = fbprov.Prov.Banco;
                CuentaProveedor = fbprov.Prov.Cuenta;
            }

        }

        private void AlmacenComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (TipoEgresoComboBox.Text == "TRANSFERENCIA")
            {
                if (AlmacenComboBox.SelectedValue != null)
                {
                    CajeroComboBox.DisplayMember = "Cajero";
                    CajeroComboBox.ValueMember = "IdUsuario";
                    CajeroComboBox.DataSource = AperturaCaja.CajeroAperturaAlmacenNocerrada(Fecha, int.Parse(AlmacenComboBox.SelectedValue.ToString()), VariablesPublicas._IdUsuario);
                }

                //CajeroComboBox.SelectedIndex = 0;

            }

        }

        private void BancoComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {

            //if (Naturaleza == "Egreso")
            //{

            //    switch (TipoEgresoComboBox.Text)
            //    {

            //        case "TRANSFERENCIA":

            //            if (BancoComboBox.Visible)
            //                CuentaTextBox.Text = BancoComboBox.SelectedValue.ToString(); 

            //            break;

            //    }

            //}


        }

        private void ImagenButton_Click(object sender, EventArgs e)
        {
            Foto = null;

            try
            {
                OpenFileDialog FotoOpenFileDialog = new OpenFileDialog();

                FotoOpenFileDialog.Filter = "Image files (*.jpg, *.jpeg, *.jfif, *.png) | *.jpg; *.jpeg; *.jfif; *.png";
                FotoOpenFileDialog.Title = "Seleccionar una imagen";

                if (FotoOpenFileDialog.ShowDialog() == DialogResult.OK)
                {
                    //string imagen = FotoOpenFileDialog.FileName;
                    //Foto = Image.FromFile(imagen);
                    string DocImagen = FotoOpenFileDialog.FileName;

                    Image ImagenSeleccionada = Image.FromFile(DocImagen);

                    if (ImagenSeleccionada.Width > ImagenSeleccionada.Height)
                        ImagenSeleccionada = ImageResize.ConstrainProportions(ImagenSeleccionada, 250, ImageResize.Dimensions.Width);
                    else
                        ImagenSeleccionada = ImageResize.ConstrainProportions(ImagenSeleccionada, 250, ImageResize.Dimensions.Height);

                    Foto = ImagenSeleccionada;
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show("El archivo seleccionado no es un tipo de imagen válido: " + ex.ToString());
            }
        }

        private void GrillaDataGridView_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {

            if (e.ColumnIndex == 9 & e.RowIndex >= 0 & DetalleIngresoEgreso[e.RowIndex].Imagen != null)
            {
                FormMuestraImagen fmi = new FormMuestraImagen(IngresoEgreso.ByteToImage(DetalleIngresoEgreso[e.RowIndex].Imagen));
                fmi.ShowDialog();
            }

        }

        private void GrillaDataGridView_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
            //NO BORRAR ES PARA EVITAR UN ERROR DE VALIDACION
        }

        private void AlmacenGastoCheckBox_CheckedChanged(object sender, EventArgs e)
        {
            if (AlmacenGastoCheckBox.Checked == true)
            {
                AlmacenGastoComboBox.Enabled = true;
            }
            else
            {
                AlmacenGastoComboBox.Enabled = false;
                AlmacenGastoComboBox.SelectedValue = VariablesPublicas._IdAlmacen;
            }
        }
    }
}
