@page "/cambiar-password"
@using GSCommerce.Client.Models
@using GSCommerce.Client.Services
@inject UsuarioService UsuarioService
@inject AuthService AuthService
@inject IJSRuntime JS

<h3>Cambiar Contraseña</h3>

<div class="mb-3">
    <label>Contraseña Actual</label>
    <input type="password" class="form-control" @bind="request.PasswordActual" />
</div>
<div class="mb-3">
    <label>Nueva Contraseña</label>
    <input type="password" class="form-control" @bind="request.PasswordNuevo" />
</div>
<button class="btn btn-primary" @onclick="Cambiar">Guardar</button>

@code {
    private CambiarPasswordRequest request = new();

    protected override async Task OnInitializedAsync()
    {
        request.NombreUsuario = await AuthService.GetUserName() ?? string.Empty;
    }

    private async Task Cambiar()
    {
        var ok = await UsuarioService.CambiarPasswordAsync(request);
        if (ok)
            await JS.InvokeVoidAsync("alert", "✅ Contraseña actualizada.");
        else
            await JS.InvokeVoidAsync("alert", "❌ Error al actualizar contraseña.");
        request.PasswordActual = string.Empty;
        request.PasswordNuevo = string.Empty;
    }
}